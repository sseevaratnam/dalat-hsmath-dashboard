<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dalat High School MAP Math Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #fbbf24 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .header-logo {
            height: 90px;
            width: auto;
        }

        .header-text {
            text-align: center;
        }

        h1 {
            color: #1e3a8a;
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        .subtitle {
            color: #d97706;
            font-size: 1.2em;
            font-weight: 600;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .control-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        label {
            font-weight: 600;
            color: #1e3a8a;
            margin-right: 10px;
        }

        select {
            padding: 10px 15px;
            border: 2px solid #1e3a8a;
            border-radius: 5px;
            font-size: 16px;
            background: white;
            color: #1e3a8a;
            cursor: pointer;
            transition: all 0.3s;
        }

        select:hover {
            border-color: #fbbf24;
        }

        select:focus {
            outline: none;
            border-color: #fbbf24;
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.2);
        }

        .section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .section-title {
            color: #1e3a8a;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #fbbf24;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #1e3a8a, #1e40af);
            color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #fbbf24;
        }

        .stat-unit {
            font-size: 0.5em;
            color: white;
            margin-left: 5px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 30px;
        }

        .chart-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-box {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
        }

        .chart-title {
            color: #1e3a8a;
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .instructional-areas {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .area-card {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #fbbf24;
        }

        .area-name {
            color: #1e3a8a;
            font-weight: 600;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .area-score {
            font-size: 2em;
            color: #1e3a8a;
            font-weight: bold;
        }

        .info-message {
            background: #fef3c7;
            border-left: 4px solid #fbbf24;
            padding: 15px;
            border-radius: 5px;
            color: #92400e;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .header-logo {
                height: 70px;
            }

            .chart-row {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <img src="dalat_logo.png" alt="Dalat International School" class="header-logo">
                <div class="header-text">
                    <h1>Dalat High School</h1>
                    <div class="subtitle">MAP Math Growth Dashboard | 2020-2025</div>
                </div>
            </div>
        </header>

        <div class="controls">
            <div class="control-group">
                <label for="courseSelect">Select Course:</label>
                <select id="courseSelect">
                    <option value="all">All Courses</option>
                    <option value="Algebra 1 G9">Algebra 1 (Grade 9)</option>
                    <option value="Algebra 2 G10">Algebra 2 (Grade 10)</option>
                    <option value="Geometry G9">Geometry (Grade 9)</option>
                    <option value="Geometry G10">Geometry (Grade 10)</option>
                </select>

                <label for="yearSelect">Select Year:</label>
                <select id="yearSelect">
                    <option value="all">All Years</option>
                    <option value="2024-2025">2024-2025</option>
                    <option value="2023-2024">2023-2024</option>
                    <option value="2022-2023">2022-2023</option>
                    <option value="2021-2022">2021-2022</option>
                    <option value="2020-2021">2020-2021</option>
                </select>
            </div>
            <div style="margin-top: 12px; padding: 10px; background: #eff6ff; border-left: 3px solid #3b82f6; border-radius: 4px; font-size: 0.9em; color: #1e40af;">
                <strong>üí° Tip:</strong> Select a specific course to see instructional area details. Course comparison shows all courses for the selected year. Trend charts show historical data.
            </div>
        </div>

        <!-- Section 1: Instructional Performance -->
        <div class="section">
            <h2 class="section-title">üìö Instructional Performance</h2>
            
            <div class="stats-grid" id="perfStats">
                <!-- Dynamic stats will be inserted here -->
            </div>

            <div class="chart-row">
                <div class="chart-box">
                    <div class="chart-title">RIT Score Trends Over Time</div>
                    <div style="height: 350px;">
                        <canvas id="ritTrendChart"></canvas>
                    </div>
                </div>
                <div class="chart-box">
                    <div class="chart-title">Course Comparison (All Courses for Selected Year)</div>
                    <div style="height: 350px;">
                        <canvas id="courseComparisonChart"></canvas>
                    </div>
                </div>
            </div>

            <h3 style="color: #1e3a8a; margin: 30px 0 20px 0; font-size: 1.4em;">Instructional Area Breakdown</h3>
            <div class="instructional-areas" id="instructionalAreas">
                <!-- Instructional areas will be dynamically populated -->
            </div>
            
            <div class="chart-row" style="margin-top: 30px;">
                <div class="chart-box">
                    <div class="chart-title">Instructional Area Breakdown (Selected Course & Year)</div>
                    <div style="height: 350px;">
                        <canvas id="instructionalAreaChart"></canvas>
                    </div>
                </div>
                <div class="chart-box">
                    <div class="chart-title">Instructional Area Trends (All Years for Selected Course)</div>
                    <div style="height: 350px;">
                        <canvas id="instructionalAreaTrendChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2: Growth Data -->
        <div class="section">
            <h2 class="section-title">üìà Student Growth Data</h2>
            
            <div class="stats-grid" id="growthStats">
                <!-- Dynamic growth stats will be inserted here -->
            </div>

            <div class="chart-row">
                <div class="chart-box">
                    <div class="chart-title">Observed Growth Over Time</div>
                    <div style="height: 350px;">
                        <canvas id="growthTrendChart"></canvas>
                    </div>
                </div>
                <div class="chart-box">
                    <div class="chart-title">Growth Goal Achievement Rate</div>
                    <div style="height: 350px;">
                        <canvas id="goalAchievementChart"></canvas>
                    </div>
                </div>
            </div>

            <div style="background: #eff6ff; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #3b82f6;">
                <h3 style="color: #1e3a8a; margin: 0 0 10px 0; font-size: 1.1em;">üìä Understanding the Growth Quadrant Chart</h3>
                <p style="margin: 0 0 15px 0; color: #1e40af; line-height: 1.6;">
                    This quadrant chart shows three key metrics at once:<br>
                    ‚Ä¢ <strong>X-axis (horizontal)</strong>: Observed Growth in RIT points<br>
                    ‚Ä¢ <strong>Y-axis (vertical)</strong>: Percentage of students who met their growth goal<br>
                    ‚Ä¢ <strong>Bubble Size</strong>: Mean Spring RIT score ‚Äî <em>Larger bubbles = higher achievement levels</em>
                </p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                    <div style="background: rgba(239, 68, 68, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #ef4444;">
                        <strong style="color: #dc2626;">‚¨áÔ∏è Lower Left: Needs Attention</strong><br>
                        <span style="font-size: 0.9em; color: #991b1b;">Below average growth AND goal achievement</span>
                    </div>
                    <div style="background: rgba(251, 191, 36, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                        <strong style="color: #d97706;">‚û°Ô∏è Lower Right: Growth Focus</strong><br>
                        <span style="font-size: 0.9em; color: #92400e;">High growth but fewer meeting goals</span>
                    </div>
                    <div style="background: rgba(251, 191, 36, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                        <strong style="color: #d97706;">‚¨ÜÔ∏è Upper Left: Goal Focus</strong><br>
                        <span style="font-size: 0.9em; color: #92400e;">High goal achievement but lower growth</span>
                    </div>
                    <div style="background: rgba(16, 185, 129, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #10b981;">
                        <strong style="color: #059669;">‚úÖ Upper Right: Excellent</strong><br>
                        <span style="font-size: 0.9em; color: #065f46;">High growth AND high goal achievement</span>
                    </div>
                </div>
                <p style="margin: 15px 0 0 0; color: #1e40af; font-size: 0.9em;">
                    <strong>Reference lines</strong> show the median values. Hover over bubbles to see specific data for each course/year.
                </p>
            </div>
            <div class="chart-container">
                <canvas id="comprehensiveGrowthChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Data
        const performanceData = [
            { term: "Spring 2024-2025", course: "Algebra 1 G9", meanRIT: 256.9 },
            { term: "Spring 2023-2024", course: "Algebra 1 G9", meanRIT: 258.8 },
            { term: "Spring 2022-2023", course: "Algebra 1 G9", meanRIT: 246.0 },
            { term: "Spring 2021-2022", course: "Algebra 1 G9", meanRIT: 252.8 },
            { term: "Spring 2020-2021", course: "Algebra 1 G9", meanRIT: 253.7 },
            { term: "Spring 2024-2025", course: "Algebra 2 G10", meanRIT: 276.0 },
            { term: "Spring 2023-2024", course: "Algebra 2 G10", meanRIT: 270.6 },
            { term: "Spring 2022-2023", course: "Algebra 2 G10", meanRIT: 272.1 },
            { term: "Spring 2021-2022", course: "Algebra 2 G10", meanRIT: 267.3 },
            { term: "Spring 2020-2021", course: "Algebra 2 G10", meanRIT: 271.1 },
            { term: "Spring 2024-2025", course: "Geometry G9", meanRIT: 276.0 },
            { term: "Spring 2023-2024", course: "Geometry G9", meanRIT: 278.8 },
            { term: "Spring 2022-2023", course: "Geometry G9", meanRIT: 272.2 },
            { term: "Spring 2021-2022", course: "Geometry G9", meanRIT: 268.7 },
            { term: "Spring 2020-2021", course: "Geometry G9", meanRIT: 274.5 },
            { term: "Spring 2024-2025", course: "Geometry G10", meanRIT: 259.8 },
            { term: "Spring 2023-2024", course: "Geometry G10", meanRIT: 253.3 },
            { term: "Spring 2022-2023", course: "Geometry G10", meanRIT: 256.6 },
            { term: "Spring 2021-2022", course: "Geometry G10", meanRIT: 249.0 },
            { term: "Spring 2020-2021", course: "Geometry G10", meanRIT: 258.8 }
        ];

        // Instructional Area Data
        const instructionalAreaData = {
            "Algebra 1 G9": {
                "2024-2025": {
                    "Equations and Inequalities": 256.4,
                    "Numerical and Algebraic Expressions": 260.3,
                    "Functions": 259.3,
                    "Descriptive Statistics": 251.4
                },
                "2023-2024": {
                    "Equations and Inequalities": 259.4,
                    "Numerical and Algebraic Expressions": 258.8,
                    "Functions": 263.4,
                    "Descriptive Statistics": 253.0
                },
                "2022-2023": {
                    "Equations and Inequalities": 246.9,
                    "Numerical and Algebraic Expressions": 245.5,
                    "Functions": 248.3,
                    "Descriptive Statistics": 242.6
                },
                "2021-2022": {
                    "Equations and Inequalities": 256.6,
                    "Numerical and Algebraic Expressions": 255.4,
                    "Functions": 250.4,
                    "Descriptive Statistics": 248.0
                },
                "2020-2021": {
                    "Equations and Inequalities": 257.5,
                    "Numerical and Algebraic Expressions": 255.9,
                    "Functions": 253.4,
                    "Descriptive Statistics": 247.6
                }
            },
            "Algebra 2 G10": {
                "2024-2025": {
                    "Equations and Inequalities": 274.7,
                    "Numerical and Algebraic Expressions": 279.7,
                    "Functions": 277.5,
                    "Descriptive Statistics": 270.6
                },
                "2023-2024": {
                    "Equations and Inequalities": 268.2,
                    "Numerical and Algebraic Expressions": 275.2,
                    "Functions": 272.7,
                    "Descriptive Statistics": 264.7
                },
                "2022-2023": {
                    "Equations and Inequalities": 269.6,
                    "Numerical and Algebraic Expressions": 279.4,
                    "Functions": 273.0,
                    "Descriptive Statistics": 266.5
                },
                "2021-2022": {
                    "Equations and Inequalities": 267.1,
                    "Numerical and Algebraic Expressions": 276.3,
                    "Functions": 268.1,
                    "Descriptive Statistics": 257.0
                },
                "2020-2021": {
                    "Equations and Inequalities": 270.7,
                    "Numerical and Algebraic Expressions": 280.6,
                    "Functions": 269.5,
                    "Descriptive Statistics": 264.1
                }
            },
            "Geometry G9": {
                "2024-2025": {
                    "Congruence, Similarity, Right Triangles, & Trig": 280.3,
                    "Geometric Properties with Equations and Circles": 284.1,
                    "Geometric Measurement and Modeling": 274.4,
                    "Applications of Probability": 267.0
                },
                "2023-2024": {
                    "Congruence, Similarity, Right Triangles, & Trig": 285.8,
                    "Geometric Properties with Equations and Circles": 282.7,
                    "Geometric Measurement and Modeling": 286.2,
                    "Applications of Probability": 262.6
                },
                "2022-2023": {
                    "Congruence, Similarity, Right Triangles, & Trig": 278.0,
                    "Geometric Properties with Equations and Circles": 272.5,
                    "Geometric Measurement and Modeling": 280.9,
                    "Applications of Probability": 256.7
                },
                "2021-2022": {
                    "Congruence, Similarity, Right Triangles, & Trig": 274.8,
                    "Geometric Properties with Equations and Circles": 276.3,
                    "Geometric Measurement and Modeling": 264.7,
                    "Applications of Probability": 258.0
                },
                "2020-2021": {
                    "Congruence, Similarity, Right Triangles, & Trig": 277.0,
                    "Geometric Properties with Equations and Circles": 279.7,
                    "Geometric Measurement and Modeling": 269.0,
                    "Applications of Probability": 272.6
                }
            },
            "Geometry G10": {
                "2024-2025": {
                    "Congruence, Similarity, Right Triangles, & Trig": 266.2,
                    "Geometric Properties with Equations and Circles": 264.7,
                    "Geometric Measurement and Modeling": 254.1,
                    "Applications of Probability": 253.2
                },
                "2023-2024": {
                    "Congruence, Similarity, Right Triangles, & Trig": 256.2,
                    "Geometric Properties with Equations and Circles": 256.7,
                    "Geometric Measurement and Modeling": 256.6,
                    "Applications of Probability": 243.3
                },
                "2022-2023": {
                    "Congruence, Similarity, Right Triangles, & Trig": 262.7,
                    "Geometric Properties with Equations and Circles": 258.1,
                    "Geometric Measurement and Modeling": 260.0,
                    "Applications of Probability": 246.2
                },
                "2021-2022": {
                    "Congruence, Similarity, Right Triangles, & Trig": 256.8,
                    "Geometric Properties with Equations and Circles": 251.1,
                    "Geometric Measurement and Modeling": 248.5,
                    "Applications of Probability": 240.0
                },
                "2020-2021": {
                    "Congruence, Similarity, Right Triangles, & Trig": 266.5,
                    "Geometric Properties with Equations and Circles": 259.4,
                    "Geometric Measurement and Modeling": 254.2,
                    "Applications of Probability": 255.5
                }
            }
        };

        const growthData = [
            { year: "2024-2025", course: "Algebra 1 G9", meanRIT: 256.9, growth: 12, metGoal: 74 },
            { year: "2023-2024", course: "Algebra 1 G9", meanRIT: 259.5, growth: 13, metGoal: 75 },
            { year: "2022-2023", course: "Algebra 1 G9", meanRIT: 245.3, growth: 7, metGoal: 52 },
            { year: "2021-2022", course: "Algebra 1 G9", meanRIT: 253.5, growth: 10, metGoal: 60 },
            { year: "2020-2021", course: "Algebra 1 G9", meanRIT: 253.5, growth: 10, metGoal: 61 },
            { year: "2024-2025", course: "Algebra 2 G10", meanRIT: 276.0, growth: 10, metGoal: 74 },
            { year: "2023-2024", course: "Algebra 2 G10", meanRIT: 270.6, growth: 9, metGoal: 66 },
            { year: "2022-2023", course: "Algebra 2 G10", meanRIT: 272.1, growth: 8, metGoal: 63 },
            { year: "2021-2022", course: "Algebra 2 G10", meanRIT: 267.3, growth: 5, metGoal: 55 },
            { year: "2020-2021", course: "Algebra 2 G10", meanRIT: 271.1, growth: 6, metGoal: 55 },
            { year: "2024-2025", course: "Geometry G9", meanRIT: 276.0, growth: 14, metGoal: 68 },
            { year: "2023-2024", course: "Geometry G9", meanRIT: 278.8, growth: 16, metGoal: 70 },
            { year: "2022-2023", course: "Geometry G9", meanRIT: 272.6, growth: 17, metGoal: 82 },
            { year: "2021-2022", course: "Geometry G9", meanRIT: 268.7, growth: 12, metGoal: 57 },
            { year: "2020-2021", course: "Geometry G9", meanRIT: 275.0, growth: 14, metGoal: 81 },
            { year: "2024-2025", course: "Geometry G10", meanRIT: 259.8, growth: 10, metGoal: 50 },
            { year: "2023-2024", course: "Geometry G10", meanRIT: 252.2, growth: 10, metGoal: 53 },
            { year: "2022-2023", course: "Geometry G10", meanRIT: 256.2, growth: 10, metGoal: 56 },
            { year: "2021-2022", course: "Geometry G10", meanRIT: 247.2, growth: 8, metGoal: 47 },
            { year: "2020-2021", course: "Geometry G10", meanRIT: 257.5, growth: 11, metGoal: 43 }
        ];

        // Chart configurations
        const chartColors = {
            blue: '#1e3a8a',
            lightBlue: '#3b82f6',
            gold: '#fbbf24',
            darkGold: '#f59e0b',
            algebra1: '#3b82f6',
            algebra2: '#8b5cf6',
            geometryG9: '#10b981',
            geometryG10: '#f59e0b'
        };

        let ritTrendChart, courseComparisonChart, growthTrendChart, goalAchievementChart, comprehensiveGrowthChart, instructionalAreaChart, instructionalAreaTrendChart;

        // Initialize dashboard
        function initDashboard() {
            updateStats();
            updateInstructionalAreas();
            createCharts();
            setupEventListeners();
        }

        function setupEventListeners() {
            document.getElementById('courseSelect').addEventListener('change', updateDashboard);
            document.getElementById('yearSelect').addEventListener('change', updateDashboard);
        }

        function updateDashboard() {
            updateStats();
            updateInstructionalAreas();
            updateCharts();
        }

        function filterData() {
            const course = document.getElementById('courseSelect').value;
            const year = document.getElementById('yearSelect').value;

            let filteredPerf = performanceData;
            let filteredGrowth = growthData;

            if (course !== 'all') {
                filteredPerf = filteredPerf.filter(d => d.course === course);
                filteredGrowth = filteredGrowth.filter(d => d.course === course);
            }

            if (year !== 'all') {
                const termYear = `Spring ${year}`;
                filteredPerf = filteredPerf.filter(d => d.term === termYear);
                filteredGrowth = filteredGrowth.filter(d => d.year === year);
            }

            return { performance: filteredPerf, growth: filteredGrowth };
        }

        function updateStats() {
            const data = filterData();
            updatePerformanceStats(data.performance);
            updateGrowthStats(data.growth);
        }

        function updatePerformanceStats(data) {
            const container = document.getElementById('perfStats');
            if (data.length === 0) {
                container.innerHTML = '<p style="color: #64748b;">No data available for selected filters</p>';
                return;
            }

            const avgRIT = (data.reduce((sum, d) => sum + d.meanRIT, 0) / data.length).toFixed(1);
            const latestRIT = data[0].meanRIT.toFixed(1);
            const highestRIT = Math.max(...data.map(d => d.meanRIT)).toFixed(1);
            const uniqueCourses = [...new Set(data.map(d => d.course))].length;

            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Average RIT Score</div>
                    <div class="stat-value">${avgRIT}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Latest RIT Score</div>
                    <div class="stat-value">${latestRIT}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Highest RIT Score</div>
                    <div class="stat-value">${highestRIT}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Courses Tracked</div>
                    <div class="stat-value">${uniqueCourses}<span class="stat-unit">courses</span></div>
                </div>
            `;
        }

        function updateGrowthStats(data) {
            const container = document.getElementById('growthStats');
            if (data.length === 0) {
                container.innerHTML = '<p style="color: #64748b;">No data available for selected filters</p>';
                return;
            }

            const avgGrowth = (data.reduce((sum, d) => sum + d.growth, 0) / data.length).toFixed(1);
            const avgGoalMet = (data.reduce((sum, d) => sum + d.metGoal, 0) / data.length).toFixed(0);
            const maxGrowth = Math.max(...data.map(d => d.growth));
            const maxGoalMet = Math.max(...data.map(d => d.metGoal));

            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Average Growth</div>
                    <div class="stat-value">${avgGrowth}<span class="stat-unit">RIT pts</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Avg % Met Goal</div>
                    <div class="stat-value">${avgGoalMet}<span class="stat-unit">%</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Maximum Growth</div>
                    <div class="stat-value">${maxGrowth}<span class="stat-unit">RIT pts</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Best Goal Achievement</div>
                    <div class="stat-value">${maxGoalMet}<span class="stat-unit">%</span></div>
                </div>
            `;
        }

        function updateInstructionalAreas() {
            const course = document.getElementById('courseSelect').value;
            const year = document.getElementById('yearSelect').value;
            const container = document.getElementById('instructionalAreas');

            // If "all" is selected, show latest year for all courses
            if (course === 'all') {
                container.innerHTML = `
                    <div class="info-message">
                        <strong>üí° Tip:</strong> Select a specific course to view detailed instructional area breakdowns and trends.
                    </div>
                `;
                return;
            }

            // Get the year to display
            const displayYear = year === 'all' ? '2024-2025' : year;
            
            // Get instructional area data
            const areaData = instructionalAreaData[course]?.[displayYear];

            if (!areaData) {
                container.innerHTML = '<p style="color: #64748b;">No instructional area data available for selected filters</p>';
                return;
            }

            // Create area cards
            let html = '';
            Object.entries(areaData).forEach(([area, score]) => {
                // Get the overall mean RIT for comparison
                const overallRIT = performanceData.find(d => 
                    d.course === course && d.term === `Spring ${displayYear}`
                )?.meanRIT || 0;

                const diff = (score - overallRIT).toFixed(1);
                const diffColor = diff > 0 ? '#10b981' : '#ef4444';
                const diffSign = diff > 0 ? '+' : '';

                html += `
                    <div class="area-card">
                        <div class="area-name">${area}</div>
                        <div class="area-score">${score.toFixed(1)}</div>
                        <div style="color: ${diffColor}; font-weight: 600; margin-top: 8px; font-size: 0.9em;">
                            ${diffSign}${diff} vs Overall
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function createCharts() {
            createRITTrendChart();
            createCourseComparisonChart();
            createGrowthTrendChart();
            createGoalAchievementChart();
            createComprehensiveGrowthChart();
            createInstructionalAreaChart();
            createInstructionalAreaTrendChart();
        }

        function updateCharts() {
            const data = filterData();
            
            updateRITTrendChart(data.performance);
            updateCourseComparisonChart(); // No data param - it fetches its own
            updateGrowthTrendChart(data.growth);
            updateGoalAchievementChart(data.growth);
            updateComprehensiveGrowthChart(data.growth);
            updateInstructionalAreaChart();
            updateInstructionalAreaTrendChart();
        }

        function createRITTrendChart() {
            const ctx = document.getElementById('ritTrendChart').getContext('2d');
            ritTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 240,
                            title: {
                                display: true,
                                text: 'RIT Score'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'School Year'
                            }
                        }
                    }
                }
            });
            updateRITTrendChart(performanceData);
        }

        function updateRITTrendChart(data) {
            const years = ['2020-2021', '2021-2022', '2022-2023', '2023-2024', '2024-2025'];
            const courses = [...new Set(data.map(d => d.course))];

            const datasets = courses.map(course => {
                const courseData = years.map(year => {
                    const item = data.find(d => d.term === `Spring ${year}` && d.course === course);
                    return item ? item.meanRIT : null;
                });

                const colors = {
                    'Algebra 1 G9': chartColors.algebra1,
                    'Algebra 2 G10': chartColors.algebra2,
                    'Geometry G9': chartColors.geometryG9,
                    'Geometry G10': chartColors.geometryG10
                };

                return {
                    label: course,
                    data: courseData,
                    borderColor: colors[course] || chartColors.blue,
                    backgroundColor: colors[course] || chartColors.blue,
                    tension: 0.3,
                    borderWidth: 3,
                    pointRadius: 5,
                    pointHoverRadius: 7
                };
            });

            ritTrendChart.data.labels = years;
            ritTrendChart.data.datasets = datasets;
            ritTrendChart.update();
        }

        function createCourseComparisonChart() {
            const ctx = document.getElementById('courseComparisonChart').getContext('2d');
            courseComparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Mean RIT Score',
                        data: [],
                        backgroundColor: [
                            chartColors.algebra1,
                            chartColors.algebra2,
                            chartColors.geometryG9,
                            chartColors.geometryG10
                        ],
                        borderColor: chartColors.blue,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 240,
                            title: {
                                display: true,
                                text: 'RIT Score'
                            }
                        }
                    }
                }
            });
            updateCourseComparisonChart();
        }

        function updateCourseComparisonChart() {
            // Always show all courses for the selected year (ignore course filter)
            const year = document.getElementById('yearSelect').value;
            const displayYear = year === 'all' ? '2024-2025' : year;
            
            const latestData = performanceData.filter(d => d.term === `Spring ${displayYear}`);

            if (latestData.length === 0) {
                courseComparisonChart.data.labels = [];
                courseComparisonChart.data.datasets[0].data = [];
                courseComparisonChart.update();
                return;
            }

            courseComparisonChart.data.labels = latestData.map(d => d.course);
            courseComparisonChart.data.datasets[0].data = latestData.map(d => d.meanRIT);
            courseComparisonChart.update();
        }

        function createGrowthTrendChart() {
            const ctx = document.getElementById('growthTrendChart').getContext('2d');
            growthTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Growth (RIT Points)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'School Year'
                            }
                        }
                    }
                }
            });
            updateGrowthTrendChart(growthData);
        }

        function updateGrowthTrendChart(data) {
            const years = ['2020-2021', '2021-2022', '2022-2023', '2023-2024', '2024-2025'];
            const courses = [...new Set(data.map(d => d.course))];

            const datasets = courses.map(course => {
                const courseData = years.map(year => {
                    const item = data.find(d => d.year === year && d.course === course);
                    return item ? item.growth : null;
                });

                const colors = {
                    'Algebra 1 G9': chartColors.algebra1,
                    'Algebra 2 G10': chartColors.algebra2,
                    'Geometry G9': chartColors.geometryG9,
                    'Geometry G10': chartColors.geometryG10
                };

                return {
                    label: course,
                    data: courseData,
                    borderColor: colors[course] || chartColors.blue,
                    backgroundColor: colors[course] || chartColors.blue,
                    tension: 0.3,
                    borderWidth: 3,
                    pointRadius: 5,
                    pointHoverRadius: 7
                };
            });

            growthTrendChart.data.labels = years;
            growthTrendChart.data.datasets = datasets;
            growthTrendChart.update();
        }

        function createGoalAchievementChart() {
            const ctx = document.getElementById('goalAchievementChart').getContext('2d');
            goalAchievementChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: '% Students Meeting Goal'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'School Year'
                            }
                        }
                    }
                }
            });
            updateGoalAchievementChart(growthData);
        }

        function updateGoalAchievementChart(data) {
            const years = ['2020-2021', '2021-2022', '2022-2023', '2023-2024', '2024-2025'];
            const courses = [...new Set(data.map(d => d.course))];

            const datasets = courses.map(course => {
                const courseData = years.map(year => {
                    const item = data.find(d => d.year === year && d.course === course);
                    return item ? item.metGoal : null;
                });

                const colors = {
                    'Algebra 1 G9': chartColors.algebra1,
                    'Algebra 2 G10': chartColors.algebra2,
                    'Geometry G9': chartColors.geometryG9,
                    'Geometry G10': chartColors.geometryG10
                };

                return {
                    label: course,
                    data: courseData,
                    backgroundColor: colors[course] || chartColors.blue,
                    borderColor: chartColors.blue,
                    borderWidth: 2
                };
            });

            goalAchievementChart.data.labels = years;
            goalAchievementChart.data.datasets = datasets;
            goalAchievementChart.update();
        }

        function createComprehensiveGrowthChart() {
            const ctx = document.getElementById('comprehensiveGrowthChart').getContext('2d');
            
            // Calculate median values for quadrant lines
            const allGrowth = growthData.map(d => d.growth);
            const allGoalMet = growthData.map(d => d.metGoal);
            const medianGrowth = calculateMedian(allGrowth);
            const medianGoalMet = calculateMedian(allGoalMet);
            
            comprehensiveGrowthChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: 'Growth Quadrant Analysis',
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: '#1e3a8a'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const datasetLabel = context.dataset.label || '';
                                    const growth = context.parsed.x;
                                    const goalMet = context.parsed.y;
                                    const ritScore = context.raw.ritScore || Math.round(context.raw.r * 15);
                                    return [
                                        `${datasetLabel}`,
                                        `Growth: ${growth} RIT points`,
                                        `Goal Achievement: ${goalMet}%`,
                                        `Mean RIT Score: ${ritScore}`
                                    ];
                                }
                            }
                        },
                        annotation: {
                            annotations: {
                                verticalLine: {
                                    type: 'line',
                                    xMin: medianGrowth,
                                    xMax: medianGrowth,
                                    borderColor: '#64748b',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: {
                                        display: true,
                                        content: `Median Growth: ${medianGrowth}`,
                                        position: 'start',
                                        backgroundColor: 'rgba(100, 116, 139, 0.8)',
                                        color: 'white',
                                        font: {
                                            size: 11,
                                            weight: 'bold'
                                        }
                                    }
                                },
                                horizontalLine: {
                                    type: 'line',
                                    yMin: medianGoalMet,
                                    yMax: medianGoalMet,
                                    borderColor: '#64748b',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: {
                                        display: true,
                                        content: `Median Goal Met: ${medianGoalMet}%`,
                                        position: 'end',
                                        backgroundColor: 'rgba(100, 116, 139, 0.8)',
                                        color: 'white',
                                        font: {
                                            size: 11,
                                            weight: 'bold'
                                        }
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Observed Growth (RIT Points Gained)',
                                font: {
                                    size: 13,
                                    weight: 'bold'
                                }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '% of Students Meeting Their Growth Goal',
                                font: {
                                    size: 13,
                                    weight: 'bold'
                                }
                            },
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            updateComprehensiveGrowthChart(growthData);
        }

        function calculateMedian(values) {
            const sorted = [...values].sort((a, b) => a - b);
            const middle = Math.floor(sorted.length / 2);
            
            if (sorted.length % 2 === 0) {
                return Math.round((sorted[middle - 1] + sorted[middle]) / 2);
            }
            return sorted[middle];
        }

        function updateComprehensiveGrowthChart(data) {
            const courses = [...new Set(data.map(d => d.course))];

            const datasets = courses.map(course => {
                const courseData = data.filter(d => d.course === course).map(d => ({
                    x: d.growth,
                    y: d.metGoal,
                    r: d.meanRIT / 15,  // Scale down RIT score for bubble size
                    ritScore: d.meanRIT  // Store actual RIT score for tooltip
                }));

                const colors = {
                    'Algebra 1 G9': chartColors.algebra1,
                    'Algebra 2 G10': chartColors.algebra2,
                    'Geometry G9': chartColors.geometryG9,
                    'Geometry G10': chartColors.geometryG10
                };

                return {
                    label: course,
                    data: courseData,
                    backgroundColor: colors[course] || chartColors.blue,
                    borderColor: chartColors.blue,
                    borderWidth: 2
                };
            });

            // Recalculate median lines based on current data
            const allGrowth = data.map(d => d.growth);
            const allGoalMet = data.map(d => d.metGoal);
            const medianGrowth = calculateMedian(allGrowth);
            const medianGoalMet = calculateMedian(allGoalMet);

            // Update annotations with new median values
            comprehensiveGrowthChart.options.plugins.annotation.annotations.verticalLine.xMin = medianGrowth;
            comprehensiveGrowthChart.options.plugins.annotation.annotations.verticalLine.xMax = medianGrowth;
            comprehensiveGrowthChart.options.plugins.annotation.annotations.verticalLine.label.content = `Median Growth: ${medianGrowth}`;
            
            comprehensiveGrowthChart.options.plugins.annotation.annotations.horizontalLine.yMin = medianGoalMet;
            comprehensiveGrowthChart.options.plugins.annotation.annotations.horizontalLine.yMax = medianGoalMet;
            comprehensiveGrowthChart.options.plugins.annotation.annotations.horizontalLine.label.content = `Median Goal Met: ${medianGoalMet}%`;

            comprehensiveGrowthChart.data.datasets = datasets;
            comprehensiveGrowthChart.update();
        }

        function createInstructionalAreaChart() {
            const ctx = document.getElementById('instructionalAreaChart').getContext('2d');
            instructionalAreaChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'RIT Score',
                        data: [],
                        backgroundColor: chartColors.gold,
                        borderColor: chartColors.blue,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: false,
                            min: 240,
                            title: {
                                display: true,
                                text: 'RIT Score'
                            }
                        }
                    }
                }
            });
            updateInstructionalAreaChart();
        }

        function updateInstructionalAreaChart() {
            const course = document.getElementById('courseSelect').value;
            const year = document.getElementById('yearSelect').value;

            if (course === 'all') {
                instructionalAreaChart.data.labels = [];
                instructionalAreaChart.data.datasets[0].data = [];
                instructionalAreaChart.update();
                return;
            }

            const displayYear = year === 'all' ? '2024-2025' : year;
            const areaData = instructionalAreaData[course]?.[displayYear];

            if (!areaData) {
                instructionalAreaChart.data.labels = [];
                instructionalAreaChart.data.datasets[0].data = [];
                instructionalAreaChart.update();
                return;
            }

            const labels = Object.keys(areaData);
            const values = Object.values(areaData);

            instructionalAreaChart.data.labels = labels;
            instructionalAreaChart.data.datasets[0].data = values;
            instructionalAreaChart.data.datasets[0].label = `${course} - ${displayYear}`;
            instructionalAreaChart.update();
        }

        function createInstructionalAreaTrendChart() {
            const ctx = document.getElementById('instructionalAreaTrendChart').getContext('2d');
            instructionalAreaTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 240,
                            title: {
                                display: true,
                                text: 'RIT Score'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'School Year'
                            }
                        }
                    }
                }
            });
            updateInstructionalAreaTrendChart();
        }

        function updateInstructionalAreaTrendChart() {
            // Always show all years for the selected course (ignore year filter)
            const course = document.getElementById('courseSelect').value;

            if (course === 'all') {
                instructionalAreaTrendChart.data.labels = [];
                instructionalAreaTrendChart.data.datasets = [];
                instructionalAreaTrendChart.update();
                return;
            }

            const courseData = instructionalAreaData[course];
            if (!courseData) {
                instructionalAreaTrendChart.data.labels = [];
                instructionalAreaTrendChart.data.datasets = [];
                instructionalAreaTrendChart.update();
                return;
            }

            const years = Object.keys(courseData).sort();
            
            if (years.length === 0) {
                instructionalAreaTrendChart.data.labels = [];
                instructionalAreaTrendChart.data.datasets = [];
                instructionalAreaTrendChart.update();
                return;
            }
            
            const areas = Object.keys(courseData[years[0]]);

            const areaColors = [
                '#3b82f6',  // Blue
                '#10b981',  // Green
                '#f59e0b',  // Orange
                '#8b5cf6'   // Purple
            ];

            const datasets = areas.map((area, index) => {
                const data = years.map(year => courseData[year][area]);
                return {
                    label: area,
                    data: data,
                    borderColor: areaColors[index % areaColors.length],
                    backgroundColor: areaColors[index % areaColors.length],
                    tension: 0.3,
                    borderWidth: 3,
                    pointRadius: 5,
                    pointHoverRadius: 7
                };
            });

            instructionalAreaTrendChart.data.labels = years;
            instructionalAreaTrendChart.data.datasets = datasets;
            instructionalAreaTrendChart.update();
        }

        // Initialize on page load
        window.addEventListener('load', initDashboard);
    </script>
</body>
</html>
